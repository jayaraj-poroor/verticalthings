using sys;

future<event> dma;
future<float> facq;

async float acq(float y, chan<spi0> comm){
    int x;
    rchan<spi0> rcomm;

    x = y * 2;
    //start data acquisition 

    rcomm = HAL_start(comm);

    comm  = await HAL_io_completion(rcomm);

    return x;
}

void irq(){
    signal dma;
}

async void main(chan<spi0> spi){
    float res;

    facq = acq(3.0, spi);
    while(1){
        res = await facq;
        facq = acq(3.0, spi);
        //processing the res while the next acq is happening
     }
}
